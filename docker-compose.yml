x-varblock: &uidblock
  uid: "${UID:-1000}"

services:
  php-apache:
    container_name: domain_history_php
    build: 
      args:
        <<: *uidblock
      context: .
      dockerfile: "./docker/php-apache/Dockerfile"
    ports:
      - 8080:8000
      - 5173:5173
    volumes:
      - .:/var/www/html
    command: sh -c "php artisan serve --host=0.0.0.0 --port=8000 & npm run dev -- --host"

  mysql:
    image: 'mysql:9'
    container_name: domain_history_mysql
    environment:
      - MYSQL_DATABASE=domain
      - MYSQL_USER=username
      - MYSQL_PASSWORD=secret
      - MYSQL_ROOT_PASSWORD=password
    ports:
      - "3306:3306"
    volumes:
      - mysql-data:/var/lib/mysql:cached

volumes:
  mysql-data:
    external: false
